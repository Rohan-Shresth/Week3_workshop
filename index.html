<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie Manager</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .movie-item { padding: 10px; border-bottom: 1px solid #ccc; }
        button { margin: 5px; }
    </style>
</head>
<body>

<h1>Movie Collection Manager</h1>

<form id="add-movie-form">
    <h3>Add New Movie</h3>
    <input type="text" id="title" placeholder="Title" required>
    <input type="text" id="genre" placeholder="Genre">
    <input type="number" id="year" placeholder="Release Year" required>
    <button type="submit">Add Movie</button>
</form>

<hr>

<h2>Movie List</h2>
<input type="text" id="search-input" placeholder="Search movies by title or genre">

<div id="movie-list"></div>

<script>
    const API_URL = 'http://localhost:3000/movies';
    const movieListDiv = document.getElementById('movie-list');
    const searchInput = document.getElementById('search-input');
    const form = document.getElementById('add-movie-form');
    let allMovies = [];

    // RENDER MOVIES
    function renderMovies(movies) {
        movieListDiv.innerHTML = '';

        if (movies.length === 0) {
            movieListDiv.innerHTML = '<p>No movies found.</p>';
            return;
        }

        movies.forEach(movie => {
            const element = document.createElement('div');
            element.classList.add('movie-item');
            element.innerHTML = `
                <p><strong>${movie.title}</strong> (${movie.year}) - ${movie.genre}</p>
                <button onclick="editMoviePrompt(${movie.id}, '${movie.title}', ${movie.year}, '${movie.genre}')">Edit</button>
                <button onclick="deleteMovie(${movie.id})">Delete</button>
            `;
            movieListDiv.appendChild(element);
        });
    }

    // GET MOVIES (READ)
    function fetchMovies() {
        fetch(API_URL)
            .then(res => res.json())
            .then(data => {
                allMovies = data;
                renderMovies(data);
            })
            .catch(err => console.error('Fetch error:', err));
    }

    fetchMovies(); // initial load

    // SEARCH
    searchInput.addEventListener('input', function () {
        const term = searchInput.value.toLowerCase();
        
        const filtered = allMovies.filter(m => 
            m.title.toLowerCase().includes(term) ||
            m.genre.toLowerCase().includes(term)
        );

        renderMovies(filtered);
    });

    // CREATE MOVIE
    form.addEventListener('submit', function (e) {
        e.preventDefault();

        const newMovie = {
            title: document.getElementById('title').value,
            genre: document.getElementById('genre').value,
            year: parseInt(document.getElementById('year').value)
        };

        fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newMovie)
        })
        .then(res => res.json())
        .then(() => {
            form.reset();
            fetchMovies();
        })
        .catch(err => console.error('Add movie error:', err));
    });

    // PROMPT FOR UPDATE
    function editMoviePrompt(id, title, year, genre) {
        const newTitle = prompt('New Title:', title);
        const newYear = prompt('New Year:', year);
        const newGenre = prompt('New Genre:', genre);

        if (newTitle && newYear && newGenre) {
            updateMovie(id, {
                id,
                title: newTitle,
                year: parseInt(newYear),
                genre: newGenre
            });
        }
    }

    // UPDATE MOVIE
    function updateMovie(id, updatedMovie) {
        fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedMovie)
        })
        .then(res => res.json())
        .then(() => fetchMovies())
        .catch(err => console.error('Update error:', err));
    }

    // DELETE MOVIE
    function deleteMovie(id) {
        fetch(`${API_URL}/${id}`, { method: 'DELETE' })
            .then(() => fetchMovies())
            .catch(err => console.error('Delete error:', err));
    }
</script>

</body>
</html>
